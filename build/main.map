{"version":3,"sources":["webpack:///webpack/bootstrap 707df9b38f75040beb2b","webpack:///./~/_babel-runtime@6.26.0@babel-runtime/regenerator/index.js","webpack:///./API/config/index.js","webpack:///./API/_mongoose/Schema/user.js","webpack:///external \"md5\"","webpack:///external \"mongoose\"","webpack:///./API/index.js","webpack:///./nuxt.config.js","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-static\"","webpack:///external \"nuxt\"","webpack:///./API/_mongoose/index.js","webpack:///./API/user/index.js","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa-router\"","webpack:///external \"regenerator-runtime\"","webpack:///./server/index.js"],"names":["jwt","secret","mongodb","host","database","port","username","password","app","routerBaseApi","roles","module","exports","name","value","role","type","String","default","validate","find","_val","val","required","email","createdAt","Date","now","updatedAt","router","config","require","post","head","title","meta","charset","content","hid","link","rel","href","css","plugins","loading","color","build","extend","ctx","isClient","rules","push","enforce","test","loader","exclude","use","User","mongoose","model","userSchema","connect","mongoUrl","then","console","log","warn","findOne","exec","create","md5","init","schema","register","next","request","body","success","err","message","data","login","user","token","sign","id","_id","cookies","set","logout","e","validateToken","statusCode","verify","process","env","HOST","PORT","bodyParser","KoaStatic","api","routes","dev","nuxt","builder","status","Promise","resolve","reject","res","on","render","req","promise","catch","listen","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 707df9b38f75040beb2b","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/_babel-runtime@6.26.0@babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","export default {\r\n  jwt: {\r\n    secret: 'nuxt-login'\r\n  },\r\n  mongodb: {\r\n    host: '127.0.0.1',\r\n    database: 'nuxt-login',\r\n    port: 27017,\r\n    username: '',\r\n    password: ''\r\n  },\r\n  app: {\r\n    host: '127.0.0.1',\r\n    port: 3000,\r\n    routerBaseApi: 'api'\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./API/config/index.js","const roles = ['normalUser', 'departmentAdmin', 'superAdmin']\r\nmodule.exports = {\r\n  name: 'user',\r\n  value: {\r\n    role: {\r\n      type: String,\r\n      default: 'normalUser',\r\n      validate: [val => !!roles.find(_val => _val === val), 'unknown role']\r\n    },\r\n    username: {\r\n      type: String,\r\n      required: true\r\n    },\r\n    password: {\r\n      type: String,\r\n      required: true\r\n    },\r\n    email: {\r\n      type: String,\r\n      required: true\r\n    },\r\n    name: {\r\n      type: String,\r\n      required: true\r\n    },\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now\r\n    },\r\n    updatedAt: {\r\n      type: Date,\r\n      default: Date.now\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./API/_mongoose/Schema/user.js","module.exports = require(\"md5\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"md5\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 4\n// module chunks = 0","import Router from 'koa-router'\r\nimport config from './config'\r\nimport * as userApi from './user'\r\n// Create koa router\r\nconst router = new Router()\r\nconst routerBaseApi = config.app.routerBaseApi\r\n// init mongodb connection&&schema\r\nrequire('./_mongoose')\r\n\r\nrouter\r\n  .post(`/${routerBaseApi}/login`, userApi.login)\r\n  .post(`/${routerBaseApi}/logout`, userApi.logout)\r\n  .post(`/${routerBaseApi}/register`, userApi.register)\r\n  .post(`/${routerBaseApi}/validateToken`, userApi.validateToken)\r\nexport default router\r\n\n\n\n// WEBPACK FOOTER //\n// ./API/index.js","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'starter',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: ['~assets/css/main.css'],\n  /*\n  ** Plugins\n  */\n  plugins: [],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n   ** Build configuration\n   */\n  build: {\n    /*\n     ** Run ESLINT on save\n     */\n    extend (config, ctx) {\n      if (ctx.isClient) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    },\n    loader: [\n      {\n        test: /\\.less$/,\n        use: [\n          {\n            loader: 'style-loader'\n          },\n          {\n            loader: 'css-loader'\n          },\n          {\n            loader: 'less-loader'\n          }\n        ]\n      }\n    ]\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa-static\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-static\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 10\n// module chunks = 0","import mongoose from 'mongoose'\r\nimport md5 from 'md5'\r\nimport config from '../config'\r\nimport userSchema from './Schema/user'\r\n\r\nconst mongoUrl = `mongodb://${config.mongodb.host}:${config.mongodb.port}/${config.mongodb.database}`\r\n/* eslint-disabled */\r\nasync function init() {\r\n  //  initialize model\r\n  const User = mongoose.model(userSchema.name)\r\n  // 先链接数据库然后再查找 不然会一直await\r\n  // connect db\r\n  mongoose.connect(mongoUrl)\r\n  .then(() => console.log('database connect successed'), () => console.warn('database connect failed'))\r\n  //  initialize superAdmin\r\n  if (!await User.findOne({ role: 'superAdmin' }).exec()) {\r\n    await User.create({\r\n      role: 'superAdmin',\r\n      username: '404450662',\r\n      email: '404450662@qq.com',\r\n      password: md5('gaozhao..'),\r\n      name: 'superAdmin'\r\n    })\r\n  }\r\n}\r\ninit()\r\n\n\n\n// WEBPACK FOOTER //\n// ./API/_mongoose/index.js","import mongoose from 'mongoose'\r\nimport jwt from 'jsonwebtoken'\r\nimport md5 from 'md5'\r\nimport config from '../config'\r\nimport schema from '../_mongoose/Schema/user'\r\n\r\nconst User = mongoose.model(schema.name, schema.value)\r\n\r\nexport const register = async(ctx, next) => {\r\n  let { username, password, email, name } = ctx.request.body\r\n  password = md5(password)\r\n  try {\r\n    if (await User.findOne({ username }).exec()) {\r\n      return (ctx.body = {\r\n        success: false,\r\n        err: {\r\n          message: 'Username Already Exits'\r\n        }\r\n      })\r\n    } else {\r\n    // try无法捕获Promise中的异常 要在promise catch中捕获 这里用await会更好 具体参考:https://segmentfault.com/q/1010000014905440\r\n    // create中若有异常则直接抛出\r\n      let data = await User.create({\r\n        role: 'normalUser',\r\n        username,\r\n        email,\r\n        password,\r\n        name\r\n      })\r\n      return (ctx.body = {\r\n        success: true,\r\n        data\r\n      })\r\n    }\r\n  } catch (e) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      err: e\r\n    })\r\n  }\r\n}\r\nexport const login = async(ctx, next) => {\r\n  let { username, password } = ctx.request.body\r\n  password = md5(password)\r\n  try {\r\n    let user = await User.findOne({ username, password }).exec()\r\n    if (user) {\r\n      let secret = config.jwt.secret\r\n      let token = jwt.sign({ username: user.username, id: user._id }, secret)\r\n      // cookies模块集成在koa中  https://github.com/pillarjs/cookies\r\n      ctx.cookies.set('token', token)\r\n      ctx.body = {\r\n        success: true,\r\n        token\r\n      }\r\n    } else {\r\n      ctx.body = {\r\n        success: false,\r\n        err: {\r\n          message: '用户名密码错误'\r\n        }\r\n      }\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: e\r\n    }\r\n  }\r\n}\r\nexport const logout = async(ctx, next) => {\r\n  try {\r\n    ctx.cookies.set('token', null)\r\n    ctx.body = {\r\n      success: true,\r\n      data: null\r\n    }\r\n  } catch (e) {\r\n    ctx.body = {\r\n      success: false,\r\n      data: e\r\n    }\r\n  }\r\n}\r\nexport const validateToken = async (ctx, next) => {\r\n  let { token, username } = ctx.request.body\r\n  if (!token) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: {\r\n        statusCode: 401,\r\n        message: 'Identity verification failed'\r\n      }\r\n    }\r\n    return\r\n  }\r\n  let user = await User.findOne({_id: jwt.verify(token, config.jwt.secret).id}).exec()\r\n  if (!user) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: {\r\n        statusCode: 404,\r\n        message: 'Page Not Found'\r\n      }\r\n    }\r\n  } else if (user.username !== username) {\r\n    ctx.body = {\r\n      success: false,\r\n      err: {\r\n        statusCode: 401,\r\n        message: 'Identity verification failed'\r\n      }\r\n    }\r\n  } else {\r\n    ctx.body = {\r\n      success: true,\r\n      user: user\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./API/user/index.js","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 15\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\nimport KoaStatic from 'koa-static'\nimport bodyParser from 'koa-bodyparser'\nimport api from '../API'\nasync function start() {\n  const app = new Koa()\n  const host = process.env.HOST || '127.0.0.1'\n  const port = process.env.PORT || 3000\n  //  bodyParser: 解析post请求的主体内容 放在ctx.request.body中\n  app.use(bodyParser())\n  //  KoaStatic: 解析静态文件\n  app.use(KoaStatic('.'))\n  //  挂载api\n  app.use(api.routes())\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}